<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>üì¶ Cat√°logo de Produtos</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      color: #fff;
      padding: 60px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 2.5rem;
      text-align: center;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    #filtro, input, textarea, button {
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      padding: 10px;
      width: 100%;
      max-width: 600px;
      margin-bottom: 15px;
    }

    form {
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      max-width: 600px;
      width: 100%;
      margin-bottom: 20px;
    }

    .galeria {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1200px;
    }

    .item {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      text-align: center;
      padding: 15px;
      transition: transform 0.3s ease;
      opacity: 0;
      cursor: pointer;
    }

    .item:hover {
      transform: scale(1.03);
    }

    .item p {
      font-size: 15px;
      margin-bottom: 5px;
    }

    .btnAdicionar { background: #00bfcc; color: #000; }
    .btnApagar { background: #cc0022; color: #fff; }
    .remover { background-color: #660000; color: white; }

    #modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #modal-content {
      background: #222;
      color: #fff;
      border-radius: 12px;
      padding: 20px;
      max-width: 90%;
      box-shadow: 0 0 20px #00bfcc;
      text-align: center;
    }

    #produtoImagem {
      width: 100%;
      max-width: 400px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    #fechar {
      position: absolute;
      top: 30px;
      right: 40px;
      font-size: 30px;
      cursor: pointer;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>üì¶ Cat√°logo de Produtos</h1>

  <input type="text" id="filtro" placeholder="üîé Buscar c√≥digo ou descri√ß√£o">

  <form id="produtoForm">
    <input type="text" id="codigo" placeholder="C√≥digo do produto (5 d√≠gitos)" required>
    <input type="text" id="descricao" placeholder="Descri√ß√£o comercial" required>
    <input type="number" id="metros" placeholder="Metros" required>
    <input type="url" id="imagem" placeholder="üîó URL da imagem externa">
    <textarea id="especificacoes" placeholder="Especifica√ß√µes t√©cnicas (1 por linha)" rows="5"></textarea>
    <button type="submit" class="btnAdicionar">‚ûï Adicionar Medida</button>
    <button type="button" id="botaoRemover" class="btnApagar">üóëÔ∏è Apagar Medida</button>
  </form>
  
  <button id="mostrarFormulario" style="
  margin-bottom: 20px;
  padding: 10px 20px;
  font-size: 1rem;
  background-color: #2980b9;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
">
üìã Novo Produto / Editar
</button>

  <div class="galeria" id="listaProdutos"></div>

  <!-- Modal com imagem e detalhes -->
  <div id="modal">
    <span id="fechar">&times;</span>
    <div id="modal-content">
    </div>
  </div>

<script>
  async function renderizarProdutos() {
    const galeria = document.getElementById("listaProdutos");
    galeria.innerHTML = "";

    try {
      const response = await fetch("http://localhost:3000/produtos");
      const produtos = await response.json();

      produtos.forEach(p => {
        const card = document.createElement("div");
        card.className = "item";
        card.innerHTML = `
          <p><strong>C√≥digo:</strong> ${p.codigo}</p>
          <p><strong>Descri√ß√£o:</strong> ${p.descricao}</p>
          <p><strong>Metros:</strong> ${p.metros}</p>
        `;
        galeria.appendChild(card);
        setTimeout(() => { card.style.opacity = 1 }, 100);
      });
    } catch (error) {
      console.error("Erro ao carregar produtos:", error);
    }
  }

  document.getElementById("produtoForm").addEventListener("submit", async e => {
    e.preventDefault();
    const codigo = document.getElementById("codigo").value.trim();
    const descricao = document.getElementById("descricao").value.trim();
    const metros = parseInt(document.getElementById("metros").value);

    if (codigo.length === 5 && metros > 0 && descricao) {
      try {
        const response = await fetch("http://localhost:3000/produtos", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ codigo, descricao, metros })
        });

        if (response.ok) {
          alert("Produto adicionado com sucesso!");
          renderizarProdutos();
          e.target.reset();
        } else {
          const error = await response.json();
          alert(`Erro ao adicionar produto: ${error.error}`);
        }
      } catch (error) {
        console.error("Erro ao adicionar produto:", error);
        alert("Erro ao adicionar produto. Tente novamente mais tarde.");
      }
    } else {
      alert("Dados inv√°lidos. Verifique os campos e tente novamente.");
    }
  });

  document.getElementById("botaoRemover").addEventListener("click", () => {
    const codigo = document.getElementById("codigo").value.trim();
    const metros = parseInt(document.getElementById("metros").value);
    let produto = produtos.find(p => p.codigo === codigo);
    if (produto) {
      const index = produto.metros.indexOf(metros);
      if (index !== -1) {
        produto.metros.splice(index, 1);
        localStorage.setItem("produtos", JSON.stringify(produtos));
        renderizarProdutos();
        alert(`Removido: ${metros} metros do c√≥digo ${codigo}`);
      } else {
        alert(`Valor ${metros}m n√£o encontrado no c√≥digo ${codigo}`);
      }
    } else {
      alert(`Produto ${codigo} n√£o existe`);
    }
    document.getElementById("produtoForm").reset();
  });

  function abrirModal(produto) {
    document.getElementById("produtoImagem").src = produto.imagem || "https://via.placeholder.com/400x300?text=Sem+Imagem";
    const info = document.getElementById("produtoInfo");
    info.innerHTML = `
    `;
    document.getElementById("produtoForm").style.display = "flex";
    document.getElementById("modal").style.display = "flex";

    document.getElementById("apagarProduto").onclick = () => {‚Ä¶};
  }

  document.getElementById("fechar").addEventListener("click", () => {
    document.getElementById("modal").style.display = "none";
  });

  document.getElementById("filtro").addEventListener("input", () => {
    const termo = document.getElementById("filtro").value.toLowerCase();
    document.querySelectorAll(".item").forEach(item => {
      item.style.display = texto.includes(termo) ? "block" : "none";
    });
    document.getElementById("produtoForm").style.display = "none";
  });
// Bot√£o para expandir/ocultar formul√°rio
document.getElementById("mostrarFormulario").addEventListener("click", () => {
  const form = document.getElementById("produtoForm");
  form.style.display = form.style.display === "none" ? "flex" : "none";
});
  renderizarProdutos();

  function abrirRemoteDesktopApp() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;

    if (/windows/i.test(userAgent)) {
      // Abrir no Windows usando diferentes m√©todos
      const link = document.createElement('a');
      link.href = 'almoxarifado.rdp';
      link.download = 'almoxarifado.rdp';
      link.click();

      setTimeout(() => {
        alert('Se o arquivo n√£o abrir automaticamente, tente usar o aplicativo Remote Desktop ou Remote Desktop 8 dispon√≠vel na Microsoft Store.');
      }, 1000);
    } else if (/macintosh|mac os x/i.test(userAgent)) {
      // Abrir no iOS
      alert('Para abrir o Remote Desktop no iOS, use o aplicativo Microsoft Remote Desktop dispon√≠vel na App Store.');
    } else {
      // Caso n√£o seja Windows ou iOS
      alert('Plataforma n√£o suportada para abrir o Remote Desktop.');
    }
  }
</script>
</body>
</html>
